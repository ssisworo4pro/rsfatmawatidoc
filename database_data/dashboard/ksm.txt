select 		mpeg.NIP,
			smf.DESKRIPSI as ksm,
			ruangan.ID,
			instalasi.DESKRIPSI as instalasi,
			ruangan.DESKRIPSI as ruangan,
			mpeg.NAMA,
			pk.NOPEN,
			pk.NOMOR,
			mtin.NAMA
	from 	master.referensi smf,
			master.ruangan ruangan,
			layanan.petugas_tindakan_medis lptm,
			master.dokter mdok,
			master.pegawai mpeg,
			layanan.tindakan_medis ltm,
			master.tindakan mtin,
			master.ruangan instalasi, 
			pendaftaran.kunjungan pk			
	where 	-- lptm.MEDIS 			 = 276 and
			lptm.MEDIS 			 = mdok.ID AND 
			mpeg.SMF			 = smf.ID and 
			smf.JENIS 			 = '26' AND
			smf.ID               = 25 AND
			mpeg.NIP 			 = mdok.NIP AND
			lptm.JENIS          in (1,2) AND
			lptm.TINDAKAN_MEDIS  = ltm.ID and
			ltm.KUNJUNGAN   	 = pk.NOMOR AND
			ltm.STATUS     		!= 0 and
			mtin.ID         	 = ltm.TINDAKAN and
			instalasi.ID		 = LEFT(pk.RUANGAN,5) and 
			instalasi.JENIS		 = 3 and
			pk.ruangan           = ruangan.ID and
			pk.ruangan			!= '101070201' and
			pk.ruangan			!= '101010125'
	order BY  pk.NOPEN DESC
	
	
	
select 		* 
	from 	master.pegawai mpeg,
			master.referensi smf
	where 	mpeg.NIP = 'K2023032031' and
			mpeg.SMF=smf.ID and
			smf.JENIS ='26'

381
select * from master.dokter where NIP = 'K2023032031'
276

select * from layanan.petugas_tindakan_medis lptm where lptm.MEDIS = 276
select * from rsfMaster.mlokasi_ruangan mr where mr.deskripsi like 'Patologi%'

select * from master.ruangan where ID = '101070201'
select * from master.ruangan where ID = '101010177'


select 		* 
	from 	master.referensi smf,
			layanan.petugas_tindakan_medis lptm,
			master.dokter mdok,
			master.pegawai mpeg,
			layanan.tindakan_medis ltm,
			master.tindakan mtin,
			pendaftaran.kunjungan pk			
	where 	-- lptm.MEDIS 			 = 276 and
			lptm.MEDIS 			 = mdok.ID AND 
			mpeg.SMF			 = smf.ID and 
			smf.JENIS 			 = '26' AND
			smf.ID               = 25 AND
			mpeg.NIP 			 = mdok.NIP AND
			lptm.JENIS          in (1,2) AND
			lptm.TINDAKAN_MEDIS  = ltm.ID and
			ltm.KUNJUNGAN   	 = pk.NOMOR AND
			ltm.STATUS     		!= 0 and
			mtin.ID         	 = ltm.TINDAKAN and
			pk.ruangan			 = '101010177'
			
select 		* 
	from 	master.referensi smf,
			master.ruangan ruangan,
			layanan.petugas_tindakan_medis lptm,
			master.dokter mdok,
			master.pegawai mpeg,
			layanan.tindakan_medis ltm,
			master.tindakan mtin,
			pendaftaran.kunjungan pk			
	where 	-- lptm.MEDIS 			 = 276 and
			lptm.MEDIS 			 = mdok.ID AND 
			mpeg.SMF			 = smf.ID and 
			smf.JENIS 			 = '26' AND
			smf.ID               = 25 AND
			mpeg.NIP 			 = mdok.NIP AND
			lptm.JENIS          in (1,2) AND
			lptm.TINDAKAN_MEDIS  = ltm.ID and
			ltm.KUNJUNGAN   	 = pk.NOMOR AND
			ltm.STATUS     		!= 0 and
			mtin.ID         	 = ltm.TINDAKAN and
			pk.ruangan           = ruangan.ID and
			pk.ruangan			!= '101070201'

			
			LEFT JOIN layanan.petugas_tindakan_medis lptm ON lptm.TINDAKAN_MEDIS = ltm.ID

			layanan.tindakan_medis ltm
			


SELECT		ltm.*,
			IFNULL(smf.DESKRIPSI,smf2.DESKRIPSI) SMF,
			IFNULL( mpeg.NIP, mpg.NIP) DOKTER,
			(miKunjungan.dashboard_klp) as KunjunganInstalasi,
			'Tindakan' as header,
			(1) as TOTAL,
			(if(pj.JENIS  = 2, 1, 0)) as BPJS,
			(if(pj.JENIS != 2, 1, 0)) as BPJSNon,
			(if(mruang.ID = ma.ID, 1, 0)) as Direct,
			(if(mruang.ID = ma.ID AND pj.JENIS  = 2, 1, 0)) as DirectBPJS,
			(if(mruang.ID = ma.ID AND pj.JENIS != 2, 1, 0)) as DirectBPJSNon,
			(if(mruang.ID != ma.ID, 1, 0)) as Indirect,
			(if(mruang.ID != ma.ID AND pj.JENIS  = 2, 1, 0)) as IndirectBPJS,
			(if(mruang.ID != ma.ID AND pj.JENIS != 2, 1, 0)) as IndirectBPJSNon
	FROM 	layanan.tindakan_medis ltm
			LEFT JOIN pembayaran.rincian_tagihan trf ON ltm.ID = trf.REF_ID and trf.JENIS=3 and trf.`STATUS` != 0
			LEFT JOIN `master`.tarif_tindakan mtf on mtf.ID=trf.TARIF_ID
			LEFT JOIN layanan.petugas_tindakan_medis lptm ON lptm.TINDAKAN_MEDIS = ltm.ID
			LEFT JOIN master.dokter mdok ON lptm.MEDIS = mdok.ID AND lptm.JENIS in (1,2)
			LEFT JOIN master.pegawai mpeg ON mpeg.NIP = mdok.NIP
			LEFT JOIN master.referensi smf on mpeg.SMF=smf.ID and smf.JENIS ='26'
			LEFT JOIN aplikasi.pengguna ustm ON ltm.OLEH=ustm.ID	
			LEFT JOIN master.pegawai mpg ON ustm.NIP=mpg.NIP AND mpg.PROFESI=4
			LEFT JOIN master.referensi smf2 on mpg.SMF=smf2.ID and smf2.JENIS ='26',
			master.tindakan mtin,
			pendaftaran.kunjungan pk
			LEFT JOIN pendaftaran.pendaftaran pp ON pp.NOMOR = pk.NOPEN
			LEFT JOIN layanan.pasien_pulang ppulang ON pk.NOMOR = ppulang.KUNJUNGAN AND ppulang.STATUS = 1
			LEFT JOIN master.pasien mps ON mps.NORM = pp.NORM
			LEFT JOIN master.referensi mref ON mps.JENIS_KELAMIN = mref.ID AND mref.JENIS = 2
			LEFT JOIN master.ruangan mruang ON mruang.ID = pk.RUANGAN
			LEFT JOIN master.ruangan ir ON ir.ID=LEFT(pk.RUANGAN,5) and ir.JENIS=3
			LEFT JOIN pendaftaran.penjamin pj ON pj.NOPEN = pp.NOMOR
			LEFT JOIN master.referensi mref2 ON pj.JENIS = mref2.ID AND mref2.JENIS = 10
			LEFT JOIN pendaftaran.tujuan_pasien tp ON tp.NOPEN=pp.NOMOR
			LEFT JOIN master.ruangan ma ON ma.ID=tp.RUANGAN
			LEFT JOIN master.ruangan ins ON ins.ID=LEFT(tp.RUANGAN,5) and ins.JENIS=3
			LEFT JOIN rsfMaster.mlokasi_ruangan miKunjungan ON miKunjungan.id = mruang.ID
	WHERE   pk.STATUS      != 0 and
			pk.MASUK       >= '2023-01-02' and
			pk.MASUK        < '2023-01-03' and
			ltm.KUNJUNGAN   = pk.NOMOR AND
			ltm.STATUS     != 0 and
			mtin.ID         = ltm.TINDAKAN and
			IFNULL( mpeg.NIP, mpg.NIP) is not null

RJ Instalasi Rawat Jalan

----------------------------------------------------------
SELECT		ltm.*,
			IFNULL(smf.DESKRIPSI,smf2.DESKRIPSI) SMF,
			IFNULL( mpeg.NIP, mpg.NIP) DOKTER,
			(miKunjungan.dashboard_klp) as KunjunganInstalasi,
			'Tindakan' as header,
			(1) as TOTAL,
			(if(pj.JENIS  = 2, 1, 0)) as BPJS,
			(if(pj.JENIS != 2, 1, 0)) as BPJSNon,
			(if(mruang.ID = ma.ID, 1, 0)) as Direct,
			(if(mruang.ID = ma.ID AND pj.JENIS  = 2, 1, 0)) as DirectBPJS,
			(if(mruang.ID = ma.ID AND pj.JENIS != 2, 1, 0)) as DirectBPJSNon,
			(if(mruang.ID != ma.ID, 1, 0)) as Indirect,
			(if(mruang.ID != ma.ID AND pj.JENIS  = 2, 1, 0)) as IndirectBPJS,
			(if(mruang.ID != ma.ID AND pj.JENIS != 2, 1, 0)) as IndirectBPJSNon
	FROM 	layanan.tindakan_medis ltm
			LEFT JOIN pembayaran.rincian_tagihan trf ON ltm.ID = trf.REF_ID and trf.JENIS=3 and trf.`STATUS` != 0
			LEFT JOIN `master`.tarif_tindakan mtf on mtf.ID=trf.TARIF_ID
			LEFT JOIN layanan.petugas_tindakan_medis lptm ON lptm.TINDAKAN_MEDIS = ltm.ID
			LEFT JOIN master.dokter mdok ON lptm.MEDIS = mdok.ID AND lptm.JENIS in (1,2)
			LEFT JOIN master.pegawai mpeg ON mpeg.NIP = mdok.NIP
			LEFT JOIN master.referensi smf on mpeg.SMF=smf.ID and smf.JENIS ='26'
			LEFT JOIN aplikasi.pengguna ustm ON ltm.OLEH=ustm.ID	
			LEFT JOIN master.pegawai mpg ON ustm.NIP=mpg.NIP AND mpg.PROFESI=4
			LEFT JOIN master.referensi smf2 on mpg.SMF=smf2.ID and smf2.JENIS ='26',
			master.tindakan mtin,
			pendaftaran.kunjungan pk
			LEFT JOIN pendaftaran.pendaftaran pp ON pp.NOMOR = pk.NOPEN
			LEFT JOIN layanan.pasien_pulang ppulang ON pk.NOMOR = ppulang.KUNJUNGAN AND ppulang.STATUS = 1
			LEFT JOIN master.pasien mps ON mps.NORM = pp.NORM
			LEFT JOIN master.referensi mref ON mps.JENIS_KELAMIN = mref.ID AND mref.JENIS = 2
			LEFT JOIN master.ruangan mruang ON mruang.ID = pk.RUANGAN
			LEFT JOIN master.ruangan ir ON ir.ID=LEFT(pk.RUANGAN,5) and ir.JENIS=3
			LEFT JOIN pendaftaran.penjamin pj ON pj.NOPEN = pp.NOMOR
			LEFT JOIN master.referensi mref2 ON pj.JENIS = mref2.ID AND mref2.JENIS = 10
			LEFT JOIN pendaftaran.tujuan_pasien tp ON tp.NOPEN=pp.NOMOR
			LEFT JOIN master.ruangan ma ON ma.ID=tp.RUANGAN
			LEFT JOIN master.ruangan ins ON ins.ID=LEFT(tp.RUANGAN,5) and ins.JENIS=3
			LEFT JOIN rsfMaster.mlokasi_ruangan miKunjungan ON miKunjungan.id = mruang.ID
	WHERE   pk.STATUS      != 0 and
			pk.MASUK       >= '2023-01-02' and
			pk.MASUK        < '2023-01-03' and
			ltm.KUNJUNGAN   = pk.NOMOR AND
			ltm.STATUS     != 0 and
			mtin.ID         = ltm.TINDAKAN and
			IFNULL( mpeg.NIP, mpg.NIP) is not null


=============================================
SELECT		ltm.*,
			IFNULL(smf.DESKRIPSI,smf2.DESKRIPSI) SMF,
			IFNULL( mpeg.NIP, mpg.NIP) DOKTER,
			(miKunjungan.dashboard_klp) as KunjunganInstalasi,
			'Tindakan' as header,
			(1) as TOTAL,
			(if(pj.JENIS  = 2, 1, 0)) as BPJS,
			(if(pj.JENIS != 2, 1, 0)) as BPJSNon,
			(if(mruang.ID = ma.ID, 1, 0)) as Direct,
			(if(mruang.ID = ma.ID AND pj.JENIS  = 2, 1, 0)) as DirectBPJS,
			(if(mruang.ID = ma.ID AND pj.JENIS != 2, 1, 0)) as DirectBPJSNon,
			(if(mruang.ID != ma.ID, 1, 0)) as Indirect,
			(if(mruang.ID != ma.ID AND pj.JENIS  = 2, 1, 0)) as IndirectBPJS,
			(if(mruang.ID != ma.ID AND pj.JENIS != 2, 1, 0)) as IndirectBPJSNon
	FROM 	layanan.tindakan_medis ltm
			LEFT JOIN pembayaran.rincian_tagihan trf ON ltm.ID = trf.REF_ID and trf.JENIS=3 and trf.`STATUS` != 0
			LEFT JOIN `master`.tarif_tindakan mtf on mtf.ID=trf.TARIF_ID
			LEFT JOIN layanan.petugas_tindakan_medis lptm ON lptm.TINDAKAN_MEDIS = ltm.ID
			LEFT JOIN master.dokter mdok ON lptm.MEDIS = mdok.ID AND lptm.JENIS in (1,2)
			LEFT JOIN master.pegawai mpeg ON mpeg.NIP = mdok.NIP
			LEFT JOIN master.referensi smf on mpeg.SMF=smf.ID and smf.JENIS ='26'
			LEFT JOIN aplikasi.pengguna ustm ON ltm.OLEH=ustm.ID	
			LEFT JOIN master.pegawai mpg ON ustm.NIP=mpg.NIP AND mpg.PROFESI=4
			LEFT JOIN master.referensi smf2 on mpg.SMF=smf2.ID and smf2.JENIS ='26',
			master.tindakan mtin,
			pendaftaran.kunjungan pk
			LEFT JOIN pendaftaran.pendaftaran pp ON pp.NOMOR = pk.NOPEN
			LEFT JOIN layanan.pasien_pulang ppulang ON pk.NOMOR = ppulang.KUNJUNGAN AND ppulang.STATUS = 1
			LEFT JOIN master.pasien mps ON mps.NORM = pp.NORM
			LEFT JOIN master.referensi mref ON mps.JENIS_KELAMIN = mref.ID AND mref.JENIS = 2
			LEFT JOIN master.ruangan mruang ON mruang.ID = pk.RUANGAN
			LEFT JOIN master.ruangan ir ON ir.ID=LEFT(pk.RUANGAN,5) and ir.JENIS=3
			LEFT JOIN pendaftaran.penjamin pj ON pj.NOPEN = pp.NOMOR
			LEFT JOIN master.referensi mref2 ON pj.JENIS = mref2.ID AND mref2.JENIS = 10
			LEFT JOIN pendaftaran.tujuan_pasien tp ON tp.NOPEN=pp.NOMOR
			LEFT JOIN master.ruangan ma ON ma.ID=tp.RUANGAN
			LEFT JOIN master.ruangan ins ON ins.ID=LEFT(tp.RUANGAN,5) and ins.JENIS=3
			LEFT JOIN rsfMaster.mlokasi_ruangan miKunjungan ON miKunjungan.id = mruang.ID
	WHERE   pk.STATUS      != 0 and
			pk.MASUK       >= '2023-05-01' and
			pk.MASUK        < '2023-05-05' and
			ltm.KUNJUNGAN   = pk.NOMOR AND
			ltm.STATUS     != 0 and
			mtin.ID         = ltm.TINDAKAN and
			IFNULL( mpeg.NIP, mpg.NIP) is not null
